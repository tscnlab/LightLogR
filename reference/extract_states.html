<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Extract summaries of states — extract_states • LightLogR</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extract summaries of states — extract_states"><meta name="description" content="Extracts a state from a dataset and provides their start and end times, as
well as duration and epoch. The state does not have to exist in the dataset,
but can be dynamically created. Extracted states can have group-dropping
disabled, meaning that summaries based on the extracted states show empty
groups as well."><meta property="og:description" content="Extracts a state from a dataset and provides their start and end times, as
well as duration and epoch. The state does not have to exist in the dataset,
but can be dynamically created. Extracted states can have group-dropping
disabled, meaning that summaries based on the extracted states show empty
groups as well."><meta property="og:image" content="https://tscnlab.github.io/LightLogR/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">LightLogR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Day.html">The whole game</a></li>
    <li><a class="dropdown-item" href="../articles/Import.html">Import &amp; cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/log.html">Log transformation</a></li>
    <li><a class="dropdown-item" href="../articles/Metrics.html">Metrics</a></li>
    <li><a class="dropdown-item" href="../articles/photoperiod.html">Photoperiod</a></li>
    <li><a class="dropdown-item" href="../articles/spectrum.html">Light Spectrum</a></li>
    <li><a class="dropdown-item" href="../articles/states.html">Durations, States and Clusters</a></li>
    <li><a class="dropdown-item" href="../articles/Visualizations.html">Visualizations</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-newsletter" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Newsletter</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-newsletter"><li><a class="dropdown-item" href="../Edition01.html">July 2025</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tscnlab/LightLogR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Extract summaries of states</h1>
      <small class="dont-index">Source: <a href="https://github.com/tscnlab/LightLogR/blob/main/R/extract_states.R" class="external-link"><code>R/extract_states.R</code></a></small>
      <div class="d-none name"><code>extract_states.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Extracts a state from a dataset and provides their start and end times, as
well as duration and epoch. The state does not have to exist in the dataset,
but can be dynamically created. Extracted states can have group-dropping
disabled, meaning that summaries based on the extracted states show empty
groups as well.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">extract_states</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">State.colname</span>,</span>
<span>  State.expression <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Datetime.colname <span class="op">=</span> <span class="va">Datetime</span>,</span>
<span>  handle.gaps <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  epoch <span class="op">=</span> <span class="st">"dominant.epoch"</span>,</span>
<span>  drop.empty.groups <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  group.by.state <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A light logger dataset. Expects a dataframe.</p></dd>


<dt id="arg-state-colname">State.colname<a class="anchor" aria-label="anchor" href="#arg-state-colname"></a></dt>
<dd><p>The variable or condition to be evaluated for state
exctration. Expects a symbol. If it is not part of the data, a
<code>State.expression</code> is required.</p></dd>


<dt id="arg-state-expression">State.expression<a class="anchor" aria-label="anchor" href="#arg-state-expression"></a></dt>
<dd><p>If <code>State.colname</code> is not part of the <code>data</code>, this
expression will be evaluated to generate the state. The result of this
expression will be used for grouping, so it is recommended to be
factor-like. If <code>State.colname</code> <strong>is</strong> part of the <code>data</code>, this argument will be ignored</p></dd>


<dt id="arg-datetime-colname">Datetime.colname<a class="anchor" aria-label="anchor" href="#arg-datetime-colname"></a></dt>
<dd><p>Column name that contains the datetime. Defaults to
"Datetime" which is automatically correct for data imported with LightLogR.
Expects a symbol.</p></dd>


<dt id="arg-handle-gaps">handle.gaps<a class="anchor" aria-label="anchor" href="#arg-handle-gaps"></a></dt>
<dd><p>Logical whether the data shall be treated with
<code><a href="gap_handler.html">gap_handler()</a></code>. Is set to <code>FALSE</code> by default, due to computational costs.</p></dd>


<dt id="arg-epoch">epoch<a class="anchor" aria-label="anchor" href="#arg-epoch"></a></dt>
<dd><p>The epoch to use for the gapless sequence. Can be either a
<code><a href="https://lubridate.tidyverse.org/reference/duration.html" class="external-link">lubridate::duration()</a></code> or a string. If it is a string, it needs to be
either '"dominant.epoch"' (the default) for a guess based on the data or a
valid <code><a href="https://lubridate.tidyverse.org/reference/duration.html" class="external-link">lubridate::duration()</a></code> string, e.g., <code>"1 day"</code> or <code>"10 sec"</code>.</p></dd>


<dt id="arg-drop-empty-groups">drop.empty.groups<a class="anchor" aria-label="anchor" href="#arg-drop-empty-groups"></a></dt>
<dd><p>Logical. Should empty groups be dropped? Only works
if <code>.drop = FALSE</code> has not been used with the current grouping prior to
calling the function. Default to <code>TRUE</code>. If set to <code>FALSE</code> can lead to an
error if factors are present in the grouping that have more levels than
actual data. Can, however, be useful and necessary when summarizing the
groups further, e.g. through <code><a href="summarize_numeric.html">summarize_numeric()</a></code> - having an empty group
present is important when averaging numbers.</p></dd>


<dt id="arg-group-by-state">group.by.state<a class="anchor" aria-label="anchor" href="#arg-group-by-state"></a></dt>
<dd><p>Logical. Should the output be automatically be grouped
by the new state?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a dataframe with one row per state instance. Each row will consist
of the original dataset grouping, the state column. A state.count column,
start and end Datetimes, as well as a duration of the state</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#summarizing states "photoperiod"</span></span></span>
<span class="r-in"><span><span class="va">states</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span><span class="va">sample.data.environment</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="photoperiod.html">add_photoperiod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">48.52</span>, <span class="fl">9.06</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">extract_states</span><span class="op">(</span><span class="va">photoperiod.state</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">states</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Groups:   Id, photoperiod.state [1]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Id          photoperiod.state state.count epoch start              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> Environment day               day 1          30 2023-08-29 <span style="color: #949494;">06:03:23</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> Environment day               day 2          30 2023-08-30 <span style="color: #949494;">06:04:53</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2 more variables: end &lt;dttm&gt;, duration &lt;Duration&gt;</span></span>
<span class="r-in"><span><span class="va">states</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Groups:   Id, photoperiod.state [1]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Id          photoperiod.state state.count epoch start              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> Participant night             night 6        10 2023-09-02 <span style="color: #949494;">20:36:49</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> Participant night             night 7        10 2023-09-03 <span style="color: #949494;">20:34:39</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2 more variables: end &lt;dttm&gt;, duration &lt;Duration&gt;</span></span>
<span class="r-in"><span><span class="va">states</span> <span class="op">|&gt;</span> <span class="fu"><a href="summarize_numeric.html">summarize_numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"state.count"</span>, <span class="st">"epoch"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 4 × 7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Groups:   Id [2]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Id          photoperiod.state mean_start mean_end mean_duration        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;time&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;time&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;Duration&gt;</span>           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> Environment day               06<span style="color: #949494;">:</span>07<span style="color: #949494;">:</span>08   20<span style="color: #949494;">:</span>39<span style="color: #949494;">:</span>58 52370s (~14.55 hours)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> Environment night             21<span style="color: #949494;">:</span>08<span style="color: #949494;">:</span>32   08<span style="color: #949494;">:</span>40<span style="color: #949494;">:</span>23 29169s (~8.1 hours)  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> Participant day               06<span style="color: #949494;">:</span>07<span style="color: #949494;">:</span>04   20<span style="color: #949494;">:</span>39<span style="color: #949494;">:</span>56 52372s (~14.55 hours)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> Participant night             21<span style="color: #949494;">:</span>08<span style="color: #949494;">:</span>30   08<span style="color: #949494;">:</span>40<span style="color: #949494;">:</span>20 29167s (~8.1 hours)  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2 more variables: total_duration &lt;Duration&gt;, episodes &lt;int&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Zauner, Manuel Spitschan, Steffen Hartmeyer, European Partnership on Metrology.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

