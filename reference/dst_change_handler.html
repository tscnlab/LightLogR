<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Handle jumps in Daylight Savings (DST) that are missing in the data — dst_change_handler • LightLogR</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Handle jumps in Daylight Savings (DST) that are missing in the data — dst_change_handler"><meta name="description" content="When data is imported through LightLogR and a timezone applied, it is
assumed that the timestamps are correct - which is the case, e.g., if
timestamps are stored in UTC, or they are in local time. Some if not most
measurement devices are set to local time before a recording interval starts.
If during the recording a daylight savings jump happens (in either
direction), the device might not adjust timestamps for this change. This
results in an unwanted shift in the data, starting at the time of the DST
jump and likely continues until the end of a file. dst_change_handler is
used to detect such jumps within a group and apply the correct shift in the
data (i.e., the shift that should have been applied by the device).
important Note that this function is only useful if the time stamp in
the raw data deviates from the actual date-time. Note also, that this
function results in a gap during the DST jump, which should be handled by
gap_handler() afterwards. It will also result in potentially double the
timestamps during the jum back from DST to standard time. This will result
in some inconsistencies with some functions, so we recommend to use
aggregate_Datetime() afterwards with a unit equal to the dominant epoch.
Finally, the function is not equipped to handle more than one jump per group.
The jump is based on whether the group starts out with DST or not. the
function will remove datetime rows with NA values."><meta property="og:description" content="When data is imported through LightLogR and a timezone applied, it is
assumed that the timestamps are correct - which is the case, e.g., if
timestamps are stored in UTC, or they are in local time. Some if not most
measurement devices are set to local time before a recording interval starts.
If during the recording a daylight savings jump happens (in either
direction), the device might not adjust timestamps for this change. This
results in an unwanted shift in the data, starting at the time of the DST
jump and likely continues until the end of a file. dst_change_handler is
used to detect such jumps within a group and apply the correct shift in the
data (i.e., the shift that should have been applied by the device).
important Note that this function is only useful if the time stamp in
the raw data deviates from the actual date-time. Note also, that this
function results in a gap during the DST jump, which should be handled by
gap_handler() afterwards. It will also result in potentially double the
timestamps during the jum back from DST to standard time. This will result
in some inconsistencies with some functions, so we recommend to use
aggregate_Datetime() afterwards with a unit equal to the dominant epoch.
Finally, the function is not equipped to handle more than one jump per group.
The jump is based on whether the group starts out with DST or not. the
function will remove datetime rows with NA values."><meta property="og:image" content="https://tscnlab.github.io/LightLogR/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">LightLogR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Day.html">The whole game</a></li>
    <li><a class="dropdown-item" href="../articles/Import.html">Import &amp; cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/log.html">Log transformation</a></li>
    <li><a class="dropdown-item" href="../articles/Metrics.html">Metrics</a></li>
    <li><a class="dropdown-item" href="../articles/photoperiod.html">Photoperiod</a></li>
    <li><a class="dropdown-item" href="../articles/spectrum.html">Light Spectrum</a></li>
    <li><a class="dropdown-item" href="../articles/states.html">Durations, States and Clusters</a></li>
    <li><a class="dropdown-item" href="../articles/Visualizations.html">Visualizations</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tscnlab/LightLogR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Handle jumps in Daylight Savings (DST) that are missing in the data</h1>
      <small class="dont-index">Source: <a href="https://github.com/tscnlab/LightLogR/blob/main/R/dst.R" class="external-link"><code>R/dst.R</code></a></small>
      <div class="d-none name"><code>dst_change_handler.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>When data is imported through <code>LightLogR</code> and a timezone applied, it is
assumed that the timestamps are correct - which is the case, e.g., if
timestamps are stored in <code>UTC</code>, or they are in local time. Some if not most
measurement devices are set to local time before a recording interval starts.
If during the recording a daylight savings jump happens (in either
direction), the device might not adjust timestamps for this change. This
results in an unwanted shift in the data, starting at the time of the DST
jump and likely continues until the end of a file. <code>dst_change_handler</code> is
used to detect such jumps within a group and apply the correct shift in the
data (i.e., the shift that should have been applied by the device).</p>
<p><strong>important</strong> Note that this function is only useful if the time stamp in
the raw data deviates from the actual date-time. Note also, that this
function results in a gap during the DST jump, which should be handled by
<code><a href="gap_handler.html">gap_handler()</a></code> afterwards. It will also result in potentially double the
timestamps during the jum back from DST to standard time. This will result
in some inconsistencies with some functions, so we recommend to use
<code><a href="aggregate_Datetime.html">aggregate_Datetime()</a></code> afterwards with a <code>unit</code> equal to the dominant epoch.
Finally, the function is not equipped to handle more than one jump per group.
The jump is based on whether the group starts out with DST or not. <strong>the
function will remove datetime rows with <code>NA</code> values</strong>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dst_change_handler</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  Datetime.colname <span class="op">=</span> <span class="va">Datetime</span>,</span>
<span>  filename.colname <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>dataset to be summarized, must be a <code>dataframe</code></p></dd>


<dt id="arg-datetime-colname">Datetime.colname<a class="anchor" aria-label="anchor" href="#arg-datetime-colname"></a></dt>
<dd><p>name of the column that contains the Datetime data, expects a <code>symbol</code></p></dd>


<dt id="arg-filename-colname">filename.colname<a class="anchor" aria-label="anchor" href="#arg-filename-colname"></a></dt>
<dd><p>(optional) column name that contains the filename.
If provided, it will use this column as a temporary grouping variable
additionally to the <code>dataset</code> grouping.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>tibble</code> with the same columns as the input dataset, but shifted</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The detection of a DST jump is based on the function <code><a href="https://lubridate.tidyverse.org/reference/dst.html" class="external-link">lubridate::dst()</a></code> and jumps are only applied within a group. During import, this function is used if <code>dst_adjustment = TRUE</code> is set and includes by default the filename as the grouping variable, additionally to <code>Id</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other DST:
<code><a href="dst_change_summary.html">dst_change_summary</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#create some data that crosses a DST jump</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> </span></span>
<span class="r-in"><span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span> Datetime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.POSIXt.html" class="external-link">seq.POSIXt</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2023-03-26 01:30:00"</span>, tz <span class="op">=</span> <span class="st">"Europe/Berlin"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2023-03-26 03:00:00"</span>, tz <span class="op">=</span> <span class="st">"Europe/Berlin"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     by <span class="op">=</span> <span class="st">"30 mins"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     Value <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co">#as can be seen next, there is a gap in the data - this is necessary when</span></span></span>
<span class="r-in"><span> <span class="co">#using a timezone with DST. </span></span></span>
<span class="r-in"><span> <span class="va">data</span><span class="op">$</span><span class="va">Datetime</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "2023-03-26 01:30:00 CET"  "2023-03-26 03:00:00 CEST"</span>
<span class="r-in"><span> <span class="co">#Let us say now, that the device did not adjust for the DST - thus the 03:00 </span></span></span>
<span class="r-in"><span> <span class="co">#timestamp is actually 04:00 in local time. This can be corrected for by:</span></span></span>
<span class="r-in"><span> <span class="va">data</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">dst_change_handler</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">Datetime</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "2023-03-26 01:30:00 CET"  "2023-03-26 04:00:00 CEST"</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Zauner, Manuel Spitschan, Steffen Hartmeyer, MeLiDos, EURAMET, European Union.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

