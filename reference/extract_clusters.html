<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Find and extract clusters from a dataset — extract_clusters • LightLogR</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Find and extract clusters from a dataset — extract_clusters"><meta name="description" content="extract_clusters() searches for and summarizes clusters where
data meets a certain condition. Clusters have a specified duration and can
be interrupted while still counting as one cluster. The variable can either
be a column in the dataset or an expression that gets evaluated in a
dplyr::mutate() call.
Cluster start and end times are shifted by half of the epoch each. E.g., a
state lasting for 4 measurement points will have a duration of 4
measurement intervals, and a state only occuring once, of one interval.
This deviates from simply using the time difference between the first and
last occurance, which would be one epoch shorter (e.g., the start and end
points for a state lasting a single point is identical, i.e., zero
duration)
For correct cluster identification, there can be no gaps in the data!
Gaps can inadvertently be introduced to a gapless dataset through grouping.
E.g., when grouping by photoperiod (day/night) within a participant, this
introduces gaps between the individual days and nights that together form
the group. To avoid this, either group by individual days and nights (e.g.,
by using number_states() before grouping), which will make sure a cluster
cannot extend beyond any grouping. Alternatively, you can set handle.gaps = TRUE (at computational cost).
add_clusters() identifies clusters and adds them back into the
dataset through a rolling join. This is a convenience function built on extract_clusters()."><meta property="og:description" content="extract_clusters() searches for and summarizes clusters where
data meets a certain condition. Clusters have a specified duration and can
be interrupted while still counting as one cluster. The variable can either
be a column in the dataset or an expression that gets evaluated in a
dplyr::mutate() call.
Cluster start and end times are shifted by half of the epoch each. E.g., a
state lasting for 4 measurement points will have a duration of 4
measurement intervals, and a state only occuring once, of one interval.
This deviates from simply using the time difference between the first and
last occurance, which would be one epoch shorter (e.g., the start and end
points for a state lasting a single point is identical, i.e., zero
duration)
For correct cluster identification, there can be no gaps in the data!
Gaps can inadvertently be introduced to a gapless dataset through grouping.
E.g., when grouping by photoperiod (day/night) within a participant, this
introduces gaps between the individual days and nights that together form
the group. To avoid this, either group by individual days and nights (e.g.,
by using number_states() before grouping), which will make sure a cluster
cannot extend beyond any grouping. Alternatively, you can set handle.gaps = TRUE (at computational cost).
add_clusters() identifies clusters and adds them back into the
dataset through a rolling join. This is a convenience function built on extract_clusters()."><meta property="og:image" content="https://tscnlab.github.io/LightLogR/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">LightLogR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Day.html">The whole game</a></li>
    <li><a class="dropdown-item" href="../articles/Import.html">Import &amp; cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/log.html">Log transformation</a></li>
    <li><a class="dropdown-item" href="../articles/Metrics.html">Metrics</a></li>
    <li><a class="dropdown-item" href="../articles/photoperiod.html">Photoperiod</a></li>
    <li><a class="dropdown-item" href="../articles/spectrum.html">Light Spectrum</a></li>
    <li><a class="dropdown-item" href="../articles/states.html">Durations, States and Clusters</a></li>
    <li><a class="dropdown-item" href="../articles/Visualizations.html">Visualizations</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tscnlab/LightLogR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Find and extract clusters from a dataset</h1>
      <small class="dont-index">Source: <a href="https://github.com/tscnlab/LightLogR/blob/v0.9.0/R/clusters.R" class="external-link"><code>R/clusters.R</code></a></small>
      <div class="d-none name"><code>extract_clusters.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>extract_clusters()</code> searches for and summarizes clusters where
data meets a certain condition. Clusters have a specified duration and can
be interrupted while still counting as one cluster. The variable can either
be a column in the dataset or an expression that gets evaluated in a
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code> call.</p>
<p>Cluster start and end times are shifted by half of the epoch each. E.g., a
state lasting for 4 measurement points will have a duration of 4
measurement intervals, and a state only occuring once, of one interval.
This deviates from simply using the time difference between the first and
last occurance, which would be one epoch shorter (e.g., the start and end
points for a state lasting a single point is identical, i.e., zero
duration)</p>
<p><strong>For correct cluster identification, there can be no gaps in the data!</strong>
Gaps can inadvertently be introduced to a gapless dataset through grouping.
E.g., when grouping by photoperiod (day/night) within a participant, this
introduces gaps between the individual days and nights that together form
the group. To avoid this, either group by individual days and nights (e.g.,
by using <code><a href="number_states.html">number_states()</a></code> before grouping), which will make sure a cluster
cannot extend beyond any grouping. Alternatively, you can set <code>handle.gaps = TRUE</code> (at computational cost).</p>
<p><code>add_clusters()</code> identifies clusters and adds them back into the
dataset through a rolling join. This is a convenience function built on <code>extract_clusters()</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">extract_clusters</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">Variable</span>,</span>
<span>  Datetime.colname <span class="op">=</span> <span class="va">Datetime</span>,</span>
<span>  cluster.duration <span class="op">=</span> <span class="st">"30 mins"</span>,</span>
<span>  duration.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span>,</span>
<span>  interruption.duration <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  interruption.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max"</span>, <span class="st">"min"</span><span class="op">)</span>,</span>
<span>  cluster.colname <span class="op">=</span> <span class="va">state.count</span>,</span>
<span>  return.only.clusters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  handle.gaps <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">add_clusters</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">Variable</span>,</span>
<span>  Datetime.colname <span class="op">=</span> <span class="va">Datetime</span>,</span>
<span>  cluster.duration <span class="op">=</span> <span class="st">"30 mins"</span>,</span>
<span>  duration.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span>,</span>
<span>  interruption.duration <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  interruption.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max"</span>, <span class="st">"min"</span><span class="op">)</span>,</span>
<span>  cluster.colname <span class="op">=</span> <span class="va">state</span>,</span>
<span>  handle.gaps <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A light logger dataset. Expects a dataframe.</p></dd>


<dt id="arg-variable">Variable<a class="anchor" aria-label="anchor" href="#arg-variable"></a></dt>
<dd><p>The variable or condition to be evaluated for clustering. Can
be a column name or an expression.</p></dd>


<dt id="arg-datetime-colname">Datetime.colname<a class="anchor" aria-label="anchor" href="#arg-datetime-colname"></a></dt>
<dd><p>Column name that contains the datetime. Defaults to
"Datetime" which is automatically correct for data imported with LightLogR.
Expects a symbol.</p></dd>


<dt id="arg-cluster-duration">cluster.duration<a class="anchor" aria-label="anchor" href="#arg-cluster-duration"></a></dt>
<dd><p>The minimum or maximum duration of a cluster.
Defaults to 30 minutes. Expects a lubridate duration object (or a numeric
in seconds).</p></dd>


<dt id="arg-duration-type">duration.type<a class="anchor" aria-label="anchor" href="#arg-duration-type"></a></dt>
<dd><p>Type of the duration requirement for clusters. Either
"min" (minimum duration) or "max" (maximum duration). Defaults to "min".</p></dd>


<dt id="arg-interruption-duration">interruption.duration<a class="anchor" aria-label="anchor" href="#arg-interruption-duration"></a></dt>
<dd><p>The duration of allowed interruptions within a
cluster. Defaults to 0 (no interruptions allowed).</p></dd>


<dt id="arg-interruption-type">interruption.type<a class="anchor" aria-label="anchor" href="#arg-interruption-type"></a></dt>
<dd><p>Type of the interruption duration. Either "max"
(maximum interruption) or "min" (minimum interruption). Defaults to "max".</p></dd>


<dt id="arg-cluster-colname">cluster.colname<a class="anchor" aria-label="anchor" href="#arg-cluster-colname"></a></dt>
<dd><p>Name of the column to use for the cluster
identification. Defaults to "state.count". Expects a symbol.</p></dd>


<dt id="arg-return-only-clusters">return.only.clusters<a class="anchor" aria-label="anchor" href="#arg-return-only-clusters"></a></dt>
<dd><p>Whether to return only the identified clusters
(TRUE) or also include non-clusters (FALSE). Defaults to TRUE.</p></dd>


<dt id="arg-handle-gaps">handle.gaps<a class="anchor" aria-label="anchor" href="#arg-handle-gaps"></a></dt>
<dd><p>Logical whether the data shall be treated with
<code><a href="gap_handler.html">gap_handler()</a></code>. Is set to <code>FALSE</code> by default, due to computational costs.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For <code>extract_clusters()</code> a dataframe containing the identified
clusters or all time periods, depending on <code>return.only.clusters</code>.</p>
<p>For <code>add_clusters()</code> a dataframe containing the original data with an additional column
for cluster identification.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dataset</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span><span class="va">sample.data.environment</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Id</span> <span class="op">==</span> <span class="st">"Participant"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract clusters with minimum duration of 1 hour and interruptions of up to 5 minutes</span></span></span>
<span class="r-in"><span><span class="va">dataset</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span> <span class="fu">extract_clusters</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">MEDI</span> <span class="op">&gt;</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  cluster.duration <span class="op">=</span> <span class="st">"1 hour"</span>,</span></span>
<span class="r-in"><span>  interruption.duration <span class="op">=</span> <span class="st">"5 mins"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 8 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Groups:   Id [1]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Id          state.count start               end                 epoch     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;Duration&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> Participant 1           2023-08-31 <span style="color: #949494;">10:22:59</span> 2023-08-31 <span style="color: #949494;">11:26:39</span> 10s       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> Participant 2           2023-09-01 <span style="color: #949494;">16:09:29</span> 2023-09-01 <span style="color: #949494;">18:47:19</span> 10s       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> Participant 3           2023-09-02 <span style="color: #949494;">12:32:39</span> 2023-09-02 <span style="color: #949494;">13:56:09</span> 10s       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> Participant 4           2023-09-02 <span style="color: #949494;">14:06:59</span> 2023-09-02 <span style="color: #949494;">15:48:49</span> 10s       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> Participant 5           2023-09-02 <span style="color: #949494;">16:55:19</span> 2023-09-02 <span style="color: #949494;">19:26:39</span> 10s       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> Participant 6           2023-09-03 <span style="color: #949494;">12:41:29</span> 2023-09-03 <span style="color: #949494;">13:55:59</span> 10s       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">7</span> Participant 7           2023-09-03 <span style="color: #949494;">15:07:59</span> 2023-09-03 <span style="color: #949494;">16:18:19</span> 10s       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">8</span> Participant 8           2023-09-03 <span style="color: #949494;">16:52:29</span> 2023-09-03 <span style="color: #949494;">18:44:59</span> 10s       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 1 more variable: duration &lt;Duration&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add clusters to a dataset where lux values are above 1000 for at least 30 minutes</span></span></span>
<span class="r-in"><span><span class="va">dataset_with_clusters</span> <span class="op">&lt;-</span> </span></span>
<span class="r-in"><span><span class="va">sample.data.environment</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">add_clusters</span><span class="op">(</span><span class="va">MEDI</span> <span class="op">&gt;</span> <span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dataset_with_clusters</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Groups:   Id [2]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Id          state     n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> Environment 1      <span style="text-decoration: underline;">1</span>535</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> Environment 2      <span style="text-decoration: underline;">1</span>579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> Environment 3      <span style="text-decoration: underline;">1</span>541</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> Environment 4      <span style="text-decoration: underline;">1</span>544</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> Environment 5      <span style="text-decoration: underline;">1</span>577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> Environment 6      <span style="text-decoration: underline;">1</span>550</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> Environment <span style="color: #BB0000;">NA</span>     <span style="text-decoration: underline;">7</span>954</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> Participant 1       429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> Participant 2       211</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> Participant 3       189</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span> Participant 4       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span> Participant <span style="color: #BB0000;">NA</span>    <span style="text-decoration: underline;">50</span>826</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Zauner, Manuel Spitschan, Steffen Hartmeyer, MeLiDos, EURAMET, European Union.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

