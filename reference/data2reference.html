<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create reference data from other data — data2reference • LightLogR</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create reference data from other data — data2reference"><meta name="description" content="Create reference data from almost any other data that has a datetime column
and a data column. The reference data can even be created from subsets of the
same data. Examples are that one participant can be used as a reference for
all other participants, or that the first (second,...) day of every
participant data is the reference for any other day. This function needs to
be carefully handled, when the reference data time intervals are shorter than
the data time intervals. In that case, use aggregate_Datetime() on the
reference data beforehand to lengthen the interval."><meta property="og:description" content="Create reference data from almost any other data that has a datetime column
and a data column. The reference data can even be created from subsets of the
same data. Examples are that one participant can be used as a reference for
all other participants, or that the first (second,...) day of every
participant data is the reference for any other day. This function needs to
be carefully handled, when the reference data time intervals are shorter than
the data time intervals. In that case, use aggregate_Datetime() on the
reference data beforehand to lengthen the interval."><meta property="og:image" content="https://tscnlab.github.io/LightLogR/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">LightLogR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Day.html">The whole game</a></li>
    <li><a class="dropdown-item" href="../articles/Import.html">Import &amp; cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/log.html">Log transformation</a></li>
    <li><a class="dropdown-item" href="../articles/Metrics.html">Metrics</a></li>
    <li><a class="dropdown-item" href="../articles/photoperiod.html">Photoperiod</a></li>
    <li><a class="dropdown-item" href="../articles/spectrum.html">Light Spectrum</a></li>
    <li><a class="dropdown-item" href="../articles/states.html">Durations, States and Clusters</a></li>
    <li><a class="dropdown-item" href="../articles/Visualizations.html">Visualizations</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-newsletter" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Newsletter</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-newsletter"><li><a class="dropdown-item" href="../Edition01.html">July 2025</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tscnlab/LightLogR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create reference data from other data</h1>
      <small class="dont-index">Source: <a href="https://github.com/tscnlab/LightLogR/blob/main/R/data2reference.R" class="external-link"><code>R/data2reference.R</code></a></small>
      <div class="d-none name"><code>data2reference.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create reference data from almost any other data that has a datetime column
and a data column. The reference data can even be created from subsets of the
same data. Examples are that one participant can be used as a reference for
all other participants, or that the first (second,...) day of every
participant data is the reference for any other day. <strong>This function needs to
be carefully handled, when the reference data time intervals are shorter than
the data time intervals. In that case, use <code><a href="aggregate_Datetime.html">aggregate_Datetime()</a></code> on the
reference data beforehand to lengthen the interval.</strong></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">data2reference</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  Reference.data <span class="op">=</span> <span class="va">dataset</span>,</span>
<span>  Datetime.column <span class="op">=</span> <span class="va">Datetime</span>,</span>
<span>  Data.column <span class="op">=</span> <span class="va">MEDI</span>,</span>
<span>  Id.column <span class="op">=</span> <span class="va">Id</span>,</span>
<span>  Reference.column <span class="op">=</span> <span class="va">Reference</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  filter.expression.reference <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  across.id <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  shift.start <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  length.restriction.seconds <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  shift.intervals <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  Reference.label <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>A light logger dataset</p></dd>


<dt id="arg-reference-data">Reference.data<a class="anchor" aria-label="anchor" href="#arg-reference-data"></a></dt>
<dd><p>The data that should be used as reference. By default
the <code>dataset</code> will be used as reference.</p></dd>


<dt id="arg-datetime-column">Datetime.column<a class="anchor" aria-label="anchor" href="#arg-datetime-column"></a></dt>
<dd><p>Datetime column of the <code>dataset</code> and <code>Reference.data</code>.
Need to be the same in both sets. Default is <code>Datetime</code>.</p></dd>


<dt id="arg-data-column">Data.column<a class="anchor" aria-label="anchor" href="#arg-data-column"></a></dt>
<dd><p>Data column in the <code>Reference.data</code> that is then converted
to a reference. Default is <code>MEDI</code>.</p></dd>


<dt id="arg-id-column">Id.column<a class="anchor" aria-label="anchor" href="#arg-id-column"></a></dt>
<dd><p>Name of the <code>Id.column</code> in both the <code>dataset</code> and the
<code>Reference.data</code>.</p></dd>


<dt id="arg-reference-column">Reference.column<a class="anchor" aria-label="anchor" href="#arg-reference-column"></a></dt>
<dd><p>Name of the reference column that will be added to
the <code>dataset</code>. Default is <code>Reference</code>. Cannot be the same as any other
column in the <code>dataset</code> and will throw an error if it is.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>If <code>TRUE</code> (defaults to <code>FALSE</code>), the function will
overwrite the <code>Reference.colname</code> column if it already exists.</p></dd>


<dt id="arg-filter-expression-reference">filter.expression.reference<a class="anchor" aria-label="anchor" href="#arg-filter-expression-reference"></a></dt>
<dd><p>Expression that is used to filter the
<code>Reference.data</code> before it is used as reference. Default is <code>NULL</code>. See</p></dd>


<dt id="arg-across-id">across.id<a class="anchor" aria-label="anchor" href="#arg-across-id"></a></dt>
<dd><p>Grouping variables that should be ignored when creating the
reference data. Default is <code>FALSE</code>. If <code>TRUE</code>, all grouping variables are
ignored. If <code>FALSE</code>, no grouping variables are ignored. If a vector of
grouping variables is given, these are ignored.</p></dd>


<dt id="arg-shift-start">shift.start<a class="anchor" aria-label="anchor" href="#arg-shift-start"></a></dt>
<dd><p>If <code>TRUE</code>, the reference data is shifted to the start of
the respective group. Default is <code>FALSE</code>. The shift ignores the groups
specified in <code>across.id</code>.</p></dd>


<dt id="arg-length-restriction-seconds">length.restriction.seconds<a class="anchor" aria-label="anchor" href="#arg-length-restriction-seconds"></a></dt>
<dd><p>Restricts the application of reference data
to a maximum length in seconds. Default is <code>60</code> seconds. This is useful to
avoid reference data being applied to long periods of time, e.g., when
there are gaps in the reference data</p></dd>


<dt id="arg-shift-intervals">shift.intervals<a class="anchor" aria-label="anchor" href="#arg-shift-intervals"></a></dt>
<dd><p>Time shift in seconds, that is applied to every data
point in the reference data. Default is <code>"auto"</code>. If <code>"auto"</code>, the shift is
calculated by halving the most frequent time difference between two data
points in the reference data. If a number is given, this number in seconds
is used as the shift. Can also use <code><a href="https://lubridate.tidyverse.org/reference/duration.html" class="external-link">lubridate::duration()</a></code> to specify the
shift.</p></dd>


<dt id="arg-reference-label">Reference.label<a class="anchor" aria-label="anchor" href="#arg-reference-label"></a></dt>
<dd><p>Label that is added to the reference data. If <code>NULL</code>,
no label is added.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>dataset</code> with a new column <code>Reference</code> that contains the reference
data.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>To use subsets of data, use the <code>filter.expression.reference</code> argument to
specify the subsets of data. The <code>across.id</code> argument specifies whether the
reference data should be used across all or some grouping variables (e.g.,
across participants). The <code>shift.start</code> argument enables a shift of the
reference data start time to the start of the respective group.</p>
<p>and @examples for more information. The expression is evaluated
within <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘lubridate’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     date, intersect, setdiff, union</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gg_reference</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">dataset</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Datetime</span>, y <span class="op">=</span> <span class="va">MEDI</span>, color <span class="op">=</span> <span class="va">Id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Reference</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.25</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Id</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#in this example, each data point is its own reference</span></span></span>
<span class="r-in"><span><span class="va">sample.data.environment</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">data2reference</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">gg_reference</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span>
<span class="r-plt img"><img src="data2reference-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#in this example, the first day of each ID is the reference for the other days</span></span></span>
<span class="r-in"><span><span class="co">#this requires grouping of the Data by Day, which is then specified in across.id</span></span></span>
<span class="r-in"><span><span class="co">#also, shift.start needs to be set to TRUE, to shift the reference data to the</span></span></span>
<span class="r-in"><span><span class="co">#start of the groupings</span></span></span>
<span class="r-in"><span><span class="va">sample.data.environment</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Id</span>, Day <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_date</a></span><span class="op">(</span><span class="va">Datetime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span><span class="fu">data2reference</span><span class="op">(</span></span></span>
<span class="r-in"><span>  filter.expression.reference <span class="op">=</span>  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_date</a></span><span class="op">(</span><span class="va">Datetime</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_date</a></span><span class="op">(</span><span class="va">Datetime</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  shift.start <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  across.id <span class="op">=</span> <span class="st">"Day"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">gg_reference</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(Id, Day)`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding missing grouping variables: `Id`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(Id)`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(Id, Day)`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(Id, Day)`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding missing grouping variables: `Day`</span>
<span class="r-plt img"><img src="data2reference-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#in this example, the Environment Data will be used as a reference</span></span></span>
<span class="r-in"><span><span class="va">sample.data.environment</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span><span class="fu">data2reference</span><span class="op">(</span></span></span>
<span class="r-in"><span>  filter.expression.reference <span class="op">=</span>  <span class="va">Id</span> <span class="op">==</span> <span class="st">"Environment"</span>,</span></span>
<span class="r-in"><span>  across.id <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">gg_reference</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="data2reference-3.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Zauner, Manuel Spitschan, Steffen Hartmeyer, European Partnership on Metrology.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

